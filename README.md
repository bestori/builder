builder
=======

Rake driven application builder from a database schema. 

A set of rake tasks and ruby classes to generate various types of application artifacts using a database schema as the 
source of data.  This is useful if you want to create a Ruby On Rails (with AngularJS) application and you already have a legacy database or you prefer to create the database DDL manually to take advantage of the powerful features of your database engine.

## Dependencies

- Mysql2 or JDBC-Mysql connector
- Rake

## Installation

git clone https://github.com/damianham/builder.git

## Usage

### Step 1  - generate the schema file from the database
```
 rake -f builder/tasks/mysql2.rake build_schema[testdb,testuser,testpass]    
```

Generates a testdb_column_info.yml file from the testdb database schema using a username of testuser and password of testpass 
using the mysql2 gem.  Use jdbc_mysql.rake if using JRuby.  To get the best results the tables in the database should define foreign key constraints and use table and column comments throughout.  For example for MySQL we can create a set of related tables with

```
create table `users` (
  `id` int(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `username` varchar(32) NOT NULL COMMENT 'The user identity used to login to the system',
  `password` varchar(64) NOT NULL COMMENT 'MD5 digest of the users password',
  `secret` varchar(255) NOT NULL COMMENT 'The users answer to the secret question for account recovery', 
  `updated_at` TIMESTAMP COMMENT 'Rails convention - date time the record was last updated',
  `created_at` DATETIME COMMENT 'Rails convention - date time the record was initially created'
) COMMENT 'Users are people who can login to the system and create interesting posts and witty comments';

create table `posts` (
  `id` int(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `title` varchar(255) NOT NULL COMMENT 'The title of the post that will appear in lists, tables and headings',
  `content` text NOT NULL COMMENT 'The main body content of the post',
  `user_id` int(10) NOT NULL COMMENT 'Foreign key to the user record in the users table that created the post',
  `updated_at` TIMESTAMP COMMENT 'Rails convention - date time the record was last updated',
  `created_at` DATETIME COMMENT 'Rails convention - date time the record was initially created',
  KEY `posts_user_id` (`user_id`),
  CONSTRAINT `posts_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`)
) COMMENT 'Posts are created by users and contain really interesting information';

create table `comments` ( 
  `id` int(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `content` text NOT NULL COMMENT 'The main body content of the comment',
  `post_id` int(10) NOT NULL COMMENT 'Foreign key to the post record in the posts table the comment relates to',
  `user_id` int(10) NOT NULL COMMENT 'Foreign key to the user record in the users table that created the comment',
  `updated_at` TIMESTAMP COMMENT 'Rails convention - date time the record was last updated',
  `created_at` DATETIME COMMENT 'Rails convention - date time the record was initially created',
  KEY `comments_post_id` (`post_id`),
  KEY `comments_user_id` (`user_id`),
  CONSTRAINT `comments_post_id_fk` FOREIGN KEY (`post_id`) REFERENCES `posts`(`id`)
  CONSTRAINT `comments_user_id_fk` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`)
) COMMENT 'Comments completely trash the contents of posts - or maybe not';

```

### Step 2 - create any other application structures using other generators

For example you may want to create a Ruby on Rails application using the rails application generator

```
rails new mywebapp
```

### Step 3 - Edit tasks/builder.rake to configure the builder

#### define the generators
```
@builders = [RailsBuilder,AngularRailsBuilder]
```

If you want to use the scaffold generator that ships with Rails then change RailsBuilder to RailsVanillaBuilder however note that the models generated by the Rails scaffold generator will not have the has_many and belongs_to method calls to define the class relationships, nor will it have the validation method calls for required columns.

#### define the output folders
For example if you created a new rails application using the rails application generator as described above and you have 
a directory structure like
```
- workspace
  * builder
  * mywebapp
```

then you would set the output folders to the following values

```
#### define the output destinations relative to where you run the rake command
OUTPUT_FOLDERS = {
  RailsBuilder => './mywebapp',
  AngularRailsBuilder => './mywebapp/app/assets/javascripts'
}

```

and run the rake commands in the workspace directory

#### define any tables to ignore
```
IGNORE_TABLES = ['dodgy_table1','dummy_table2']
```

Do not generate artifacts for dodgy_table1 and dummy_table2

### Step 4  - generate the application artifacts

```
rake -f builder/tasks/builder.rake build_classes[testdb]
```

generates the application artifacts in the output folder using the generated testdb_column_info.yml file as input

##  TODO

- Create Rspec, Cucumber and CoffeeScript generators
- Create schema extractors for other database engines

please fork and contribute

