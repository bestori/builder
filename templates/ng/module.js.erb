'use strict';

<% 

# shorten the accessor name
singlename = singular_table_name
%>

/* module */

// model/service
/*
 * return an ngResource object with the default actions
 
{ 'get':    {method:'GET'},
    'save':   {method:'POST'},
    'query':  {method:'GET', isArray:true},
    'remove': {method:'DELETE'},
    'delete': {method:'DELETE'} };
 */ 
angular.module('<%= namespace || "mainapp" %>').factory('<%= model_name %>', ['$resource',
  function($resource){
    return $resource('<%= namespace.nil? ? "" : namespace + '/' %><%= plural_table_name %>/:<%= singlename %>Id.json', {}, {
      list: {method:'GET',  isArray:true},
      update:   {method:'PUT'}
    });
  }]);

// list controller
angular.module('<%= namespace || "mainapp" %>')
 // enclose dependencies as strings within brackets to avoid minification and create the
 // controller as an anonymous function
 .controller('<%= model_name %>ListCtrl', [ '$scope', '<%= model_name %>', 
    function ($scope, <%= model_name %>) {
    
      $scope.<%= plural_table_name %> = <%= model_name %>.list();
      
      $scope.orderProp = 'id';
    }]);


  // detail controller
angular.module('<%= namespace || "mainapp" %>')
 // enclose dependencies as strings within brackets to avoid minification and create the
 // controller as an anonymous function
 .controller('<%= model_name %>DetailCtrl', [ '$scope',  '$routeParams',  '<%= model_name %>',
    function($scope, $routeParams, <%= model_name %>) {
      
      $scope.<%= singlename %> = <%= model_name %>.get({<%= singlename %>Id: $routeParams.<%= singlename %>Id});
    
    }]);
  
 // form controller
angular.module('<%= namespace || "mainapp" %>')
 // enclose dependencies as strings within brackets to avoid minification and create the
 // controller as an anonymous function
 .controller('<%= model_name %>FormCtrl', [ '$scope',  '$routeParams',  '<%= model_name %>',
    function($scope, $routeParams, <%= model_name %>) {
      
      // process the form
      $scope.processForm = function(formData,isvalid) {
      
        $scope.submitted = true;
        
        if ($scope.<%= singlename %>.id == null) {
             <%= model_name %>.save({  },
            formData, function(data) {
              console.log(data);
              // bind success message to message
              $scope.message = data.message;
            },
            function(data) {
              console.log(data);
            
              $scope.<%= singlename %>_errors = data.errors;
              // bind error message to message
              $scope.message = data.message;
            
            }) ;
        } else {
            <%= model_name %>.update({ <%= singlename %>Id:$scope.<%= singlename %>.id },
            formData, function(data) {
              console.log(data);
              // bind success message to message
              $scope.message = data.message;
            },
            function(data) {
              console.log(data);
            
              $scope.<%= singlename %>_errors = data.errors;
              // bind error message to message
              $scope.message = data.message;
            
            }) ;
        
        }
      };
      
      // create a blank object to hold our form information or load the record
      // $scope will allow this to pass between controller and view
      if ($routeParams.<%= singlename %>Id == null) {
        $scope.<%= singlename %> = new <%= model_name %>();
      } else {
        $scope.<%= singlename %> = <%= model_name %>.get({<%= singlename %>Id: $routeParams.<%= singlename %>Id});
      }
      
    }]);
  
 /*
 
 
these work directly with $http


// list controller
angular.module('<%= namespace || "mainapp" %>')
 // enclose dependencies as strings within brackets to avoid minification and create the
 // controller as an anonymous function
 .controller('<%= model_name %>ListCtrl', [
 '$scope', 
 '$http', 
 function ($scope, $http) {
    
    $http.get('<%= namespace.nil? ? "" : namespace + '/' %><%= plural_table_name %>.json').success(function(data) {
      $scope.<%= plural_table_name %> = data;
    });
 
    $scope.orderProp = 'id';
  }
  ]
  );


  // detail controller
angular.module('<%= namespace || "mainapp" %>')
 // enclose dependencies as strings within brackets to avoid minification and create the
 // controller as an anonymous function
 .controller('<%= model_name %>DetailCtrl', [
 '$scope', 
 '$routeParams', 
 '$http',
 function($scope, $routeParams, $http) {
    $scope.<%= singlename %>Id = $routeParams.<%= singlename %>Id;
    
    $http.get('<%= namespace.nil? ? "" : namespace + '/' %><%= plural_table_name %>/' + $routeParams.<%= singlename %>Id + '.json')
      .success(function(data) {
        $scope.<%= singlename %> = data;
      });
  }
  ]
  );
  

*/

