<% 
default_namefield = nil
singlename = singular_table_name
columns = table_info['columns']

rejected_columns = ['id' ]

columns.each_pair do |name,column| 
  # get the name of the first field that is not called 'id' as default  
  if default_namefield.nil? && name != 'id'  && name !~ /_id/  
    # use this column unless it is the id primary key or a foreign key
    default_namefield = column
  end 
  end 

# determine the display field names
namefield = columns['name'] || columns['title'] || default_namefield
descfield = columns['description'] || columns['info'] || 
  columns['summary'] || columns['comment'] || columns['snippet']
%>


<div class="container-fluid">
    <!--
            enable if the class has a main image
    <img ng-src="{{mainImageUrl}}" class="<%= singlename %>">
    -->

    <h1>{{<%= singlename %>.<%= namefield['column_name'] %>}}</h1>

    <% unless descfield.nil? %>
      <p>{{<%= singlename %>.descfield['column_name']}}</p>
    <% end %>

    <!--          
            enable and rename accordingly if the class has an array of images
    <ul class="<%= singlename %>-thumbs">
      <li ng-repeat="img in <%= singlename %>.images">
        <img ng-src="{{img}}" ng-click="setImage(img)">
      </li>
    </ul>
    -->

    <div class="container-fluid">
        <span class="object-detail"><%= model_name.titleize %> Detail</span>

        <table class="<%= singlename %>-table detail-table">
            <tbody>
                <% columns.keys.reject{|key| rejected_columns.include?(key)  }.each do |key| %>
                  <tr>
                      <th><%= key.titleize %> </th><td>{{<%= singlename %>.<%= key %>}}</td>
                  </tr>
                <% end %>

            </tbody>

        </table>

        <!-- include the standard links   [back, edit, new, delete, history] -->
        <div style="margin-top: 10px;">
            <a class="btn btn-inverse" onclick="javascript:history.go( - 1)">Back</a> 
            <a class="btn btn-warning" href="<%= angular_url(plural_table_name) %>/{{ <%= singlename %>.id }}/edit" >Edit</a>
            <a class="btn btn-success" href="<%= angular_url(plural_table_name) %>/new" >New</a>
            <a class="btn btn-danger" href="<%= angular_url(plural_table_name) %>/{{ <%= singlename %>.id }}/delete" data-confirm='Are you sure?'>Delete</a>
            
            <!--
              <a class="btn btn-primary" href="<%= angular_url(plural_table_name) %>/{{ <%= singlename %>.id }}/history" >History</a>

            -->

        </div>
    </div>
</div>

<hr/>

<div class="container-fluid">
    <h1>Related Objects</h1>

    <% 
    # remove some columns from related objects tables
    rejected_columns = ['id','updated_at','created_at','comments']

    #  get related objects  
    table_info['belongs_to'].flatten.uniq.each do |key| 
      relation = key.singularize
      relname = key.singularize
      columns = schema[key]['columns']
    %>
      <div class="container related-objects belongs-to-related-objects <%= key %>-related-objects">
          <h2><%= key.to_model_name.pluralize %></h2>
          <table class="<%= relname %>-table list-table table-striped">
              <thead>
                  <tr>

                      <th><!-- link column --></th>

                      <% columns.keys.reject{|key| rejected_columns.include?(key)  }.each do |key| %>
                        <th><%= key.titleize %> </th>
                      <% end %>
                  </tr>
              </thead>

              <tbody> 
                  <tr ng-repeat="<%= relname %> in <%= singlename %>.<%= relation %>  |  limitTo: 50" ng-class="rowClass(<%= relname %>)">

                      <td>
                          <a href="/#/<%= namespace.nil? ? "" : namespace + '/' %><%= key %>/{{<%= relname %>.id}}" >
                              <i class="glyphicon glyphicon-search"></i>
                          </a>
                      </td>

                      <% columns.keys.reject{|key| rejected_columns.include?(key) }.each do |key| %>
                        <td>{{<%= relname %>.<%= key %>}}</td>
                      <% end %>
                  </tr>
              </tbody>

          </table>
      </div>
    <%  end %>

    <%
    table_info['has_many'].flatten.uniq.each do |key| 
      relation = key.pluralize
      relname = key.singularize
      columns = schema[key]['columns']
    %>
      <div class="container related-objects has-many-related-objects <%= key %>-related-objects">
          <h2><%= key.to_model_name.pluralize %></h2>
          <table class="<%= relname %>-table list-table table-striped">
              <thead>
                  <tr>

                      <th><!-- link column --></th>

                      <% columns.keys.reject{|key| rejected_columns.include?(key)  }.each do |key| %>
                        <th><%= key.titleize %> </th>
                      <% end %>
                  </tr>
              </thead>

              <tbody> 
                  <tr ng-repeat="<%= relname %> in <%= singlename %>.<%= relation %>  |  limitTo: 50" ng-class="rowClass(<%= relname %>)">

                      <td>
                          <a href="/#/<%= namespace.nil? ? "" : namespace + '/' %><%= key %>/{{<%= relname %>.id}}" >
                              <i class="glyphicon glyphicon-search"></i>
                          </a>
                      </td>

                      <% columns.keys.reject{|key| rejected_columns.include?(key) }.each do |key| %>
                        <td>{{<%= relname %>.<%= key %>}}</td>
                      <% end %>
                  </tr>
              </tbody>

          </table>
      </div>
    <%  end %>
</div>